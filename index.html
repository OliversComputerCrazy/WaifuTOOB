<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Responsive SVG Bottom Bar with Tabs</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: Arial, sans-serif;
      background: #181818;
      color: #fff;
      display: flex;
      min-height: 100vh;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      background: #202020;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    input {
      padding: 10px;
      border: none;
      border-radius: 5px;
      margin-top: 20px;
      width: 200px;
      background: #202020;
    }

    .layout {
      display: flex;
      width: 100%;
    }

  /* ---- Sidebar (Desktop) ---- */
    @media (min-width: 769px) {
      .sidebar {
        background: #202020;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        width: 200px;
        padding: 10px 0;
        transition: all 0.3s ease;
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
      }
    }

    .sidebar a {
    display: flex;
    align-items: center;
    padding: 10px 20px;
    color: white;
    text-decoration: none;
    gap: 10px;
    transition: background 0.3s;
    }

    .sidebar a:hover {
      background: #383838;
    }

    .sidebar a.active {
      background: #383838;
    }

    .icon {
      width: 40px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .label {
      display: inline-block;
    }

  /* ---- Content ---- */
    .content {
      flex: 1;
      padding: 20px;
      background: #121212;
    }

  /* ---- Tabs ---- */
    .tab {
      display: none;
    }

    .tab.active {
      display: block;
    }

    .image {
      max-width: 40%;
      height: auto;
      border-radius: 8px;
      margin: 10px;
    }

  /* ---- Mobile Layout ---- */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }

      .layout {
        flex-direction: column;
      }

      .sidebar {
        background: #202020;
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
        width: 100%;
        height: 70px;
        position: fixed;
        bottom: 0;
        left: 0;
        padding: 5px 0;
        border-top: 1px solid #333;
        z-index: 100;
      }

      .sidebar a {
        flex-direction: column;
        justify-content: center;
        padding: 5px;
      }

      .label {
        display: none;
      }

      .content {
        padding-bottom: 90px; /* leave room for bottom bar */
      }

      .image {
        max-width: 80%;
        margin: 20px auto;
        display: block;
      }
    }
  </style>

</head>
<body>
  <div class="layout">
    <nav class="sidebar">
      <a href="#home" class="active">
        <span class="icon" data-src="Home.svg"></span>
        <span class="label">Home</span>
      </a>
      <a href="#loop">
        <span class="icon" data-src="Waifu-loop.svg"></span>
        <span class="label">Waifu Loop</span>
      </a>
      <a href="#toob">
        <span class="icon" data-src="waifu-TOOB.svg"></span>
        <span class="label">Waifu TOOB</span>
      </a>
      <a href="#settings">
        <span class="icon" data-src="Settings.svg"></span>
        <span class="label">Settings</span>
      </a>
    </nav>

    <main class="content">
      <div id="home" class="tab active">
        <h1>Home</h1>
        <p>Welcome to the home page.</p>
        <br>
        <p>Welcome to Waifu TOOB, your go-to website for any waifu-related content! Whether you're looking for adorable images, cute GIFs, or just want to explore the world of waifus, we've got you covered. Dive into our extensive collection and find your perfect waifu today!</p>
        <br>
        <p>You can use the sidebar to navigate between the different sections of our website.</p>
        <p>there are three main sections to this website:</p>
        <ul>
          <li>Starting with Waifu TOOB, this is where you can get static waifu images!</li>
          <li>Next up is the Waifu Loop, where you can find animated waifu GIFs!</li>
          <li>Finally, we have the settings tab, where you can adjust your preferences for the content you see on our website.</li>
        </ul>
      </div>

      <div id="loop" class="tab">
        <h1>Waifu Loop</h1>
        <p>Welcome to the Waifu loop, where you can view animated waifu .GIFs</p>
        <br>
        <input type="text" id="loopCategory" placeholder="Enter category (e.g. hug)" list="loopCategories" />
        <datalist id="loopCategories"></datalist>
        <div id="loopLoading">Loading...</div>
        <div id="loop-image-container"></div>
        <button id="loadLoopButton">Load New Waifu GIF</button>
      </div>

      <div id="toob" class="tab">
        <h1>Waifu TOOB</h1>
        <p>Welcome to waifu TOOB!</p>
        <br>
        <div id="image-container">
          <!-- New images will be appended here -->
        </div>
        <button id="loadButton">Load New Waifu Image</button>
      </div>

      <div id="settings" class="tab">
        <h1>Settings</h1>
        <p>Here you can adjust and modify settings to give you the best experience.</p>
        <br><hr><br>
        <h2>Waifu TOOB Settings</h2>
        <p>Contain NSFW images?</p>
        <select id="NSFWselect">
          <option value="True">Always</option>
          <option value="All">Sometimes</option>
          <option value="False" selected>Never</option>
        </select>
        <br>
        <h2>Waifu Loop Settings</h2>
        <p>Contain NSFW images?</p>
        <select id="loopNSFWselect">
          <option value="True">Yes</option>
          <option value="False" selected>No</option>
        </select>
      </div>
    </main>
  </div>

  <script>
    // --- Load external SVGs inline so their JS animations can run ---
    document.querySelectorAll('.icon').forEach(icon => {
      const src = icon.dataset.src;
      fetch(src)
        .then(res => res.text())
        .then(svg => {
          icon.innerHTML = svg;

          const temp = document.createElement('div');
          temp.innerHTML = svg;
          temp.querySelectorAll('script').forEach(oldScript => {
            const newScript = document.createElement('script');
            if (oldScript.src) {
              newScript.src = oldScript.src;
            } else {
              newScript.textContent = oldScript.textContent;
            }
            document.body.appendChild(newScript);
          });
        })
        .catch(err => console.error('Error loading SVG:', src, err));
    });

    // --- Tab switching functionality ---
    const navLinks = document.querySelectorAll('.sidebar a');
    const tabs = document.querySelectorAll('.tab');

    navLinks.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();

        navLinks.forEach(l => l.classList.remove('active'));
        tabs.forEach(tab => tab.classList.remove('active'));

        link.classList.add('active');

        const targetId = link.getAttribute('href').substring(1);
        document.getElementById(targetId).classList.add('active');
      });
    });

    // --- Waifu TOOB ---
    async function loadNewImage() {
      try {
        let NSFW = false;
        let nsfwValue = document.getElementById('NSFWselect').value;
        localStorage.setItem('nsfwSetting', nsfwValue); // Save setting to localStorage
        const apiUrl = 'https://api.waifu.im/images';
        const params = { IsNsfw: nsfwValue };
        const queryParams = new URLSearchParams(params);
        const requestUrl = `${apiUrl}?${queryParams.toString()}`;

        const response = await fetch(requestUrl);
        const data = await response.json();

        if (data.items && data.items[0]) {
          const imageUrl = data.items[0].url;

          // Create a new image element
          const img = document.createElement('img');
          img.src = imageUrl;
          img.className = 'image';
          img.alt = 'Random waifu image';

          // Append it to the container
          document.getElementById('image-container').appendChild(img);
        } else {
          console.error('No image data in response:', data);
        }
      } catch (error) {
        console.error('Error fetching image:', error);
      }
    }

    // Load an initial image when the page loads
    window.addEventListener('DOMContentLoaded', () => {
      loadNewImage(); // loads first image automatically
    });

    // Button click event for more images
    document.getElementById('loadButton').addEventListener('click', loadNewImage);

    // --- Waifu Loop ---
    const SFWloopCategories = [
      "bite", "blush", "comfy", "cry", "cuddle", "dance", "fluff",
      "hug", "kiss", "lay", "lick", "pat", "poke", "pout",
      "slap", "smile", "tail", "tickle"
    ];
    let NSFWloopCategories = [];
    let loopCategories = [...SFWloopCategories];
    let NSFWloopEnabled = false;

    // Load NSFW categories (if available)
    fetch('./categories.json')
      .then(response => response.json())
      .then(data => {
        NSFWloopCategories = data.categories || [];
        updateLoopDatalist();
      })
      .catch(error => {
        console.warn('Error loading NSFW JSON, using SFW only:', error);
        updateLoopDatalist();
      });

    // Elements
    const datalist = document.getElementById("loopCategories");
    const loopCatInput = document.getElementById("loopCategory");
    const loopImageContainer = document.getElementById("loop-image-container");
    const loopLoadBtn = document.getElementById("loadLoopButton");
    const loopLoading = document.getElementById("loopLoading");
    const loopNSFWselect = document.getElementById("loopNSFWselect");

    const maxAttempts = 50;

    // --- Update datalist based on NSFW toggle ---
  // --- Update datalist based on NSFW toggle ---
  function updateLoopDatalist() {
    datalist.innerHTML = "";
    loopCategories = NSFWloopEnabled
      ? [...NSFWloopCategories]   // Only NSFW when enabled
      : [...SFWloopCategories];   // Only SFW when disabled

    loopCategories.forEach(cat => {
      const option = document.createElement("option");
      option.value = cat;
      datalist.appendChild(option);
    });
  }


    // --- Listen to NSFW toggle ---
    loopNSFWselect.addEventListener("change", () => {
      NSFWloopEnabled = loopNSFWselect.value === "True";
      localStorage.setItem("loopNSFWSetting", loopNSFWselect.value);
      updateLoopDatalist();
    });

    // --- Build random GIF URL ---
    function buildUrl(category) {
      const nsfwPath = NSFWloopEnabled ? "nsfw" : "sfw";
      const randomNum = Math.floor(Math.random() * 150) + 1; // up to 150 gifs
      return `https://cdn.purrbot.site/${nsfwPath}/${category}/gif/${category}_${String(randomNum).padStart(3, '0')}.gif`;
    }

    // --- Load new random GIF ---
    function loadNewLoopImage() {
      const cat = loopCatInput.value.trim().toLowerCase();
      if (!cat) return alert("Please enter a category!");
      if (!loopCategories.includes(cat)) {
        alert("Invalid category! Please choose one from the list.");
        return;
      }

      loopLoading.style.display = "block";
      let attempts = 0;

      const tryLoad = () => {
        if (attempts >= maxAttempts) {
          loopLoading.style.display = "none";
          alert("No valid GIFs found for this category.");
          return;
        }

        const url = buildUrl(cat);
        const tempImg = new Image();
        tempImg.onload = () => {
          loopLoading.style.display = "none";
          const img = document.createElement("img");
          img.src = url;
          img.className = "image";
          loopImageContainer.appendChild(img);
        };
        tempImg.onerror = () => {
          attempts++;
          tryLoad();
        };
        tempImg.src = url;
      };

      tryLoad();
    }

    // --- Event bindings ---
    loopLoadBtn.addEventListener("click", loadNewLoopImage);
    loopCatInput.addEventListener("keypress", e => {
      if (e.key === "Enter") loadNewLoopImage();
    });

    // --- Initialize settings ---
    if (localStorage.getItem("loopNSFWSetting") === null) {
      localStorage.setItem("loopNSFWSetting", "False");
    }
    loopNSFWselect.value = localStorage.getItem("loopNSFWSetting");
    NSFWloopEnabled = loopNSFWselect.value === "True";
    updateLoopDatalist();


  // --- settings ---
  if (localStorage.getItem('nsfwSetting') === null) {
    localStorage.setItem('nsfwSetting', 'False'); // Default to 'False' if no setting is saved
  }
      if (localStorage.getItem('loopNSFWSetting') === null) {
    localStorage.setItem('loopNSFWSetting', 'False'); // Default to 'False' if no setting is saved
  }
  document.getElementById('NSFWselect').value = localStorage.getItem('nsfwSetting')
  if (localStorage.getItem('nsfwSetting') === 'True') {
    alert("Warning: NSFW content is enabled. This content is only suitable for adults. Please ensure you are of legal age to view such content and that you are in an appropriate environment.");
  }
  document.getElementById('loopNSFWselect').value = localStorage.getItem('loopNSFWSetting')
  if (localStorage.getItem('loopNSFWSetting') === 'True') {
    alert("Warning: NSFW content is enabled in the loop. This content is only suitable for adults. Please ensure you are of legal age to view such content and that you are in an appropriate environment.");
  }
  </script>
</body>
</html>
